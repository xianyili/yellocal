const givisitBtn = document.querySelector('#givisitorebtn');
const givisitBox = document.querySelector('#g-ivisitor');
const givisitorBox = document.querySelector('.givisitor-box');
const givisitorImge= document.querySelector('#g-visitorimge');
//const inputoprofileAdd = document.querySelector('#givisitoredditsave');
const inputoprofileAdd = document.getElementById('givisitoredditsave');
const inputoprotit= document.querySelector('#givisitoredditit');
const inputopromail= document.querySelector('#givisitoreddimail');
const inputopropic= document.querySelector('#givisitoreddipic');
const inputoprolength= document.querySelector('#givisitoreddlength');
const givisitname= document.querySelector('#givisitname');
const givisitedCloseBtn= document.querySelector('#givisitored-close');
const givisitoredImgBtn= document.querySelector('#givisitored_imgbtn');
const givisitarBox= document.querySelector('#givisitored_avatar');
const givisitarCon= document.querySelector('.givisitored_avaitem');
const givisitoredImge= document.querySelector('#givisitored_imge');

givisitBtn.addEventListener('click', (ev) => {
    ev.preventDefault();
    //showSearch();
    
     showMyvisitor();
   // alert("建设中");
  });
  givisitedCloseBtn.addEventListener('click', hideMyvisitor);
function showMyvisitor() {
    document.body.classList.add('search');
    givisitBox.classList.add('show');
   
    Myvisitorecho();
    //searchInput.focus();
  }
  
  function hideMyvisitor() {
    document.body.classList.remove('search');
    givisitBox.classList.remove('show');
  }

  givisitoredImgBtn.addEventListener('click', (ev) => {
    ev.preventDefault();
    //showSearch();
    
     showMyavatar();
     gitavatarChioce();
   // alert("建设中");
  });
  function hideMyavatar() {
    //document.body.classList.remove('search');
    givisitarBox.classList.remove('show');
  }
function showMyavatar() {
    givisitarBox.classList.add('show');
    givisitarBox.innerHTML="";
  var avatarray=["visit-1","visit-2","visit-3","visit-4","visit-5","visit-6"];
    avatarray.forEach((item, index) => { 
      //const element = avatarray[index];
       // donecounts++
      var newLi = `
      <li >
          <a data-item="${item}" href="javaScript:;" type="aliked">
          <div class="g-iFavoritem_icon">
          <p><img src="/static/pictures/avat/${item}.png" width="36px" data-item="${item}"></p>
          </div> 
          </a>    
       </li>
      `
    

      givisitarBox.innerHTML += newLi
    });
    
}
function getvisitData() {
    //通过从本地中获取元素，如果有内容，就将内容转成数组，否则就返回一个空的数组
      var data = localStorage.getItem('myprofiles');
      if (data) {
        return JSON.parse(data);
      } else {
        return []
      }
    }

    function gitavatarChioce() {
        givisitarCon.addEventListener('click', function (e) {   
            
          if (e.target.type == '') {
           // var data = getMyagendaData();
           
            //怎么知道自己点击的是第几个？可以获取设置的自定义属性
            var index = e.target.getAttribute('data-item');
            
            inputopropic.value=index;
            givisitoredImge.src="/static/pictures/avat/"+index+".png";
            hideMyavatar();
          }else{
           // alert(e.target.childNodes);
            console.log(e.target);
            var index = e.target.getAttribute('data-item');
           
            inputopropic.value=index;
            givisitoredImge.src="/static/pictures/avat/"+index+".png";
            hideMyavatar();
            
          }
        })
      }
      
function Myvisitorecho() {
    //alert("my");
  //  givisitorBox.innerHTML=("<div class=\"givisitor_inform\">"+
   // "<div class=\"givisitor_informtabs\"><div class=\"givisitor_informname\">访客ID设置</div></div>"+
   // "<div class=\"givisitor_form\"><form ><input type=\"text\" id='givisitoredditit' value=''><input type=\"text\" id='givisitoreddimail' value=''><input type=\"hidden\" id='givisitoreddipic' value='visit-1'><input type=\"button\" id='givisitoredditsave' value='确定保存..'></form></div></div>");
    var data = getvisitData(); 
   // alert(JSON.stringify(data));
   // alert(data.length);
    if(data.length>0){
    inputoprotit.value=data[0].visititle;
    inputopromail.value=data[0].visitimail;
    inputopropic.value=data[0].visitipic;
    givisitoredImge.src="/static/pictures/avat/"+data[0].visitipic+".png";
    inputoprolength.value="1";
    }
    inputoprofileAdd.value = '确认保存';
  }
  function myvisitecho() {
    var data = getvisitData(); 
    if(data.length>0){
    givisitname.innerHTML=data[0].visititle;
    givisitorImge.src="/static/pictures/avat/"+data[0].visitipic+".png";
    }
  }
inputoprofileAdd.addEventListener('click', function (e) {
    //if (e.keyCode == 13) {
     //   alert("m");
        inputoprofileAdd.value = '保存中';
      var data = getvisitData();
     // alert("m1");
      //将文本框中的内容放到data数组中
       if(inputoprolength.value=="1"){
        data[0].visititle=inputoprotit.value;
        data[0].visitipic=inputopropic.value;
        data[0].visitimail=inputopromail.value;
       }else{
      data.push({ visititle: inputoprotit.value, visitipic: inputopropic.value,visitimail: inputopromail.value, done: false })
      }
      //再将数据放在本地存储中
      localStorage.setItem('myprofiles', JSON.stringify(data));
      myvisitecho()
      hideMyvisitor()
     //最后将数据进行渲染页面
     //getMytodoHTML()
   // }
  })